program = code

comment = "#" _ .*

code = statement*

statement = "let" __ variable_declaration _
          / assignment _
          / expr _

variable_declaration  = decl _ ("," decl)*

decl = identifier __ ("=" _ expr)?

identifier = [a-z][a-zA-Z_0-9]*

variable_reference = identifier

if_expression = expr _ brace_block _ ( "else" _ brace_block _ )?

assignment  = identifier _ "=" _ expr _

expr  = "fn" _ function_definition
      / "if" _ if_expression
      / boolean_expression
      / arithmetic_expression

boolean_expression  = arithmetic_expression _ relop _ arithmetic_expression

arithmetic_expression  = mult_term _ addop _ arithmetic_expression
                       / mult_term _

mult_term  = primary _ mulop _ mult_term
           / primary _

primary  = integer
         / function_call
         / variable_reference
         / "(" _ arithmetic_expression _ ")"

integer = "-"? [0-9]+

addop   = '+' / '-'
mulop   = '*' / '/'
relop   = '==' / '!=' / '>=' / '>' / '<=' / '<'

function_call  = variable_reference _ "(" _ call_arguments _ ")"
               / "print" _ "(" _ call_arguments _ ")"

call_arguments = (expr _ ("," _ expr)*)?

function_definition = param_list _ brace_block __

param_list =  "(" _ identifier _ ("," _ identifier _)* ")"
           /  "(" _ ")"

brace_block = "{" _ code _ "}"

_ = [ \t\r\n]*
__ = [ \t\r\n]+